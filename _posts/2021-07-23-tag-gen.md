---
layout: post
comments: true
title: "ç»™ Jeklly ç”Ÿæˆ Tag Page"
date: 2021-07-23 21:00:00
tags: blog
typora-root-url: ../..
---



> ç»™ Jeklly åšå®¢æ·»åŠ  APIï¼Œç„¶åç”¨ python è¯»å– API ä¸­çš„ tag ä¿¡æ¯ï¼ŒæŒ‰å›ºå®šæ ¼å¼ç”Ÿæˆ Tag Pageã€‚

<!--more-->

{:class="table-of-content"}
* TOC
{:toc}
## Introduction

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†ä¸€æ­¥ä¸€æ­¥ä»‹ç» Jeklly ç”Ÿæˆ Tag Page çš„è¿‡ç¨‹ï¼Œä¹Ÿèƒ½ç®¡ä¸­çª¥è±¹ï¼Œæ·±å…¥ç†è§£ Jeklly ç”± markdown æ–‡ä»¶ç”Ÿæˆé™æ€ç½‘é¡µçš„åŸç†ã€‚

### ç»™ posts æ·»åŠ  tags

é¦–å…ˆï¼Œå½“æˆ‘ä»¬åœ¨ markdown æ–‡æ¡£ä¸­ä¹¦å†™æ—¶ï¼Œè¦è¾“å…¥å¤´æ–‡ä»¶ä¿¡æ¯ `YAML front matter`ï¼Œä»¥è¿™ç¯‡åšå®¢ä¸ºä¾‹ï¼Œæˆ‘ä»¬è¾“å…¥çš„ front matter ä¸ºï¼š

```yaml
---
layout: post
title: "ç»™ Jeklly ç”Ÿæˆ Tag Page"
date: 2021-07-23 21:00:00
tags: blog
---
```

å…¶ä¸­ `tags: blog` å°±è¡¨ç¤ºæˆ‘ä»¬ç»™è¿™ç¯‡æ–‡ç« è®¾å®šçš„æ ‡ç­¾ä¸º `blog` ã€‚



### æ”¶é›†æ‰€æœ‰ posts ä¸­çš„ tags

åœ¨ `_includes` æ–‡ä»¶å¤¹ä¸‹çš„ `tags.html` ä¸­ï¼ˆå…¶å®è¿™æ ·èµ·åå¹¶ä¸åˆé€‚ï¼Œå› ä¸ºæ ¹ç›®å½•ä¸‹è¿˜æœ‰ä¸€ä¸ªåŒåçš„`tags.html` æ–‡ä»¶ï¼Œä¸¤è€…å®¹æ˜“æ··æ·†ï¼‰ï¼Œæœ‰å¦‚ä¸‹ Liquid ä»£ç ï¼š

```liquid
{% raw %}{% assign rawtags = "" %}
{% for post in site.posts %}
  {% assign ttags = post.tags | join:'|' | append:'|' %}
  {% assign rawtags = rawtags | append:ttags %}
{% endfor %}
{% assign rawtags = rawtags | split:'|' | sort %}

{% assign site.tags = "" %}
{% for tag in rawtags %}
  {% if tag != "" %}
    {% if tags == "" %}
      {% assign tags = tag | split:'|' %}
    {% endif %}
    {% unless tags contains tag %}
      {% assign tags = tags | join:'|' | append:'|' | append:tag | split:'|' %}
    {% endunless %}
  {% endif %}
{% endfor %}{% endraw %}
```

å…¶å¤§æ¦‚æ„æ€æ˜¯éå†æ‰€æœ‰å‘å¸ƒçš„é¡µé¢ `site.posts` ï¼Œç„¶åå°†æ‰€æœ‰é¡µé¢çš„ tag éƒ½æ±‡å…¥ `rawtags` ä¸­ï¼Œç„¶åå¯¹ `rawtags` åˆ†å‰²åæ’åºï¼Œè¿™æ ·å°±å¾—åˆ°äº†ä¸€ä¸ªæœ‰åºçš„ tag æ•°ç»„ã€‚ç„¶åå°†æ•°ç»„å»é‡åˆå¹¶ï¼Œå°±å¾—åˆ°äº†æ‰€æœ‰ tag çš„æ±‡æ€»  `tags`ã€‚



### ç”Ÿæˆ site.tags

> æˆ‘ä¸€ç›´æ²¡ææ‡‚ `site.tags` æ˜¯æ€ä¹ˆç”Ÿæˆçš„ï¼Œä¸Šé¢çš„ä»£ç ä¸€é¡¿æ“ä½œçŒ›å¦‚è™ï¼Œä½†ä»”ç»†ä¸€çœ‹åªæ˜¯ä½œç”¨åœ¨ `tags` ä¸Šï¼Œè·Ÿ `site.tags` å®Œå…¨æ— å…³ã€‚ä½†å…¶ä»–ä»£ç ä¸­ä¹Ÿæ²¡æ‰¾åˆ°ç›¸å…³æ“ä½œï¼Œéå¸¸ç¥å¥‡ã€‚

ä½†ä¸ç®¡æ€ä¹ˆæ ·ï¼Œåœ¨ä¸€äº›ä¸æ˜è§‰å‰çš„æ“ä½œä¸‹ï¼Œ `site.tags` è¢«æå‡ºæ¥äº†ã€‚

è¿™ä¸ªåšå®¢å½“å‰çš„ `site.tags` é•¿è¿™æ ·ï¼š

```html
{
  â€œblogâ€=>[#<Jekyll::Document _posts/2021-7-21-introduction.md collection=posts>], 
  â€œ3Dâ€=>[
    #<Jekyll::Document _posts/2021-7-22-pac.md collection=posts>,
    #<Jekyll::Document _posts/2021-7-22-3D-rotation.md collection=posts>],
  â€œMLâ€=>[#<Jekyll::Document _posts/2021-7-22-pac.md collection=posts>],
  â€œtestâ€=>[#<Jekyll::Document _posts/2021-7-22-pac.md collection=posts>]
}
```

é¦–å…ˆæ˜¯ tag çš„åç§°ï¼Œæ¯ä¸ª tag éƒ½å¯¹åº”ä¸€ä¸ªæ•°ç»„ï¼Œé‡Œé¢åŒ…å«äº†æ‰€æœ‰ä¸è¯¥ tag ç›¸å…³çš„ postsã€‚

æˆ‘ä»¬å¯ä»¥ç”¨ `tag[0]` æå–è¯¥ tag çš„åç§°ï¼Œç”¨ `tag[1]` æå–åŒ…å«è¯¥ tag çš„ posts ã€‚



### æ˜¾ç¤ºå½“å‰ post çš„tags

æˆ‘ä»¬æƒ³å°†å½“å‰ page çš„æ‰€æœ‰ tag éƒ½æ˜¾ç¤ºå‡ºæ¥ï¼Œæ•ˆæœå¦‚ä¸‹å›¾ã€‚

<img src="/zjblog/assets/images/2021-07-23-tag-gen/image-20210725011927163.png" alt="image-20210725011927163" style="zoom:50%;" />

é‚£ä¹ˆå¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç æ¥å®ç°ï¼Œå¹¶ä¸”ç‚¹å‡» tag é“¾æ¥ï¼Œå°±èƒ½è·³è½¬åˆ°å¯¹åº”çš„ tag pageï¼Œå…¶ç›¸å¯¹ç½‘å€åœ¨ `/tag/tag_name` ï¼Œä¾‹å¦‚ `ML` çš„è·³è½¬é“¾æ¥ä¸º [https://theigrams.github.io/zjblog/tag/ML](https://theigrams.github.io/zjblog/tag/ML)ã€‚

```html
{% raw %}<span>[
  {% for tag in page.tags %}
    {% capture tag_name %}{{ tag }}{% endcapture %}
    <a href="/tag/{{ tag_name }}">
        <code class="highligher-rouge"><nobr>{{ tag_name }}</nobr></code>
        &nbsp;
    </a>
  {% endfor %}
]</span>{% endraw %}
```



## ç”Ÿæˆ Tag Page

æ¥ä¸‹æ¥å°±è¿›å…¥äº†æˆ‘ä»¬çš„é‡å¤´æˆéƒ¨åˆ†ï¼Œæˆ‘ä»¬è¦ç»™æ¯ä¸ª tag éƒ½ç”Ÿæˆä¸€ä¸ªå¯¹åº”çš„ç½‘é¡µï¼Œè¯¥ç½‘é¡µä¸­åŒ…å«äº†æ‰€æœ‰ä¸è¯¥ tag ç›¸å…³çš„æ–‡ç« ï¼Œå¤§è‡´çš„é¢„æœŸæ•ˆæœå¦‚ä¸‹ï¼š

![image-20210725012701061](/zjblog/assets/images/2021-07-23-tag-gen/image-20210725012701061.png)

è¿™å¯¹äºä¸€èˆ¬çš„ç½‘ç«™æ¥è¯´æ˜¯å° caseï¼Œä½†æˆ‘ä»¬è¿™ä¸ª Jeklly æ˜¯æ‰˜ç®¡åœ¨ GitHub Page ä¸Šçš„é™æ€ç½‘ç«™ï¼Œä¸èƒ½è¯´ä¸´æ—¶æ‰§è¡Œä¸€ä¸ªè„šæœ¬æ¥ç”Ÿæˆç½‘é¡µã€‚

### è§£å†³æ–¹æ¡ˆ

ä¸è¿‡åŠæ³•è¿˜æ˜¯æœ‰çš„ï¼Œä¸Šç½‘æœäº†ä¸€åœˆï¼Œä¸»è¦çš„è§£å†³æ–¹æ¡ˆåˆ†ä¸º 2 ç§ï¼š

æ–¹æ¡ˆä¸€ï¼šé€šè¿‡æ’ä»¶è§£å†³ï¼Œä½†ç¼ºç‚¹æ˜¯ GitHub ä¸æ”¯æŒè¿™ç±»æ’ä»¶ï¼Œè¦ä¹ˆæ˜¯å®šä¹‰ä¸€ç³»åˆ— GitHub Action æ¥è‡ªåŠ¨åŒ–æ“ä½œï¼Œæˆ–è€…åœ¨æœ¬åœ°ç”Ÿæˆç½‘é¡µæ–‡ä»¶ï¼Œç„¶åæ¨é€åˆ° gh åˆ†æ”¯éƒ¨ç½²ã€‚

1. [How do I tag posts in Jekyll? Jekyll tagging made simple. (untangled.dev)](https://www.untangled.dev/2020/06/02/tag-management-jekyll/)
2. [Jekyll æ·»åŠ  tag ä¸“å±é¡µé¢ \| TaoAlpha's Blog](https://taoalpha.github.io/blog/2015/06/01/tech-jekyll-tag-page/)
3. [åœ¨ Github Pages ä¸­ä½¿ç”¨Jekyllæ’ä»¶ \| TaoAlpha's Blog](https://taoalpha.github.io/blog/2015/05/29/tech-use-jekyll-plugin-with-github-page/)

æ–¹æ¡ˆäºŒï¼šç”Ÿæˆ `tag.md` æˆ– `tag.html` ï¼Œç„¶åå¥—ç”¨ `tagpage.html` æ¨¡æ¿è¿›è¡Œæ˜¾ç¤ºã€‚

`tagpage.html` ä»£ç å¦‚ä¸‹ï¼š

```html
---
layout: default
---

{% raw %}<div class="post other-pages">
    <h1>Tag: {{ page.tag }}</h1>
    <ul>
        {% for post in site.tags[page.tag] %}
        <li><a href="{{ site.baseurl }}{{ post.url }}">{{ post.title }}</a> ({{ post.date | date_to_string }})<br> {{ post.description }}
        </li>
        {% endfor %}
    </ul>
</div>
<hr>{% endraw %}
```

 `tag.md` æ ¼å¼å¦‚ä¸‹ï¼š

```markdown
---
layout: tagpage
title: "Tag: ML"
tag: ML
---
```

å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæ–¹æ¡ˆæ¯”è¾ƒç®€å•ï¼Œç”šè‡³æ‰‹åŠ¨å†™ä¸€ä¸ª md ä¹Ÿè¡Œï¼Œä½†è€ƒè™‘åˆ° tag å¯èƒ½ä¼šæœ‰ä¿®æ”¹ï¼Œé‚£æ ·çš„è¯å°±å¾ˆéº»çƒ¦äº†ï¼Œæ‰€ä»¥è¿˜æ˜¯é€šè¿‡ä»£ç è‡ªåŠ¨åŒ–ç”Ÿæˆæ¯”è¾ƒä¾¿æ·ã€‚

ç°åœ¨çš„è¯ï¼Œåªéœ€ç»™å®š tag çš„åç§°ï¼Œæˆ‘ä»¬å°±èƒ½è½»æ¾å†™å‡ºä¸€ä¸ª python ç¨‹åºæ¥ç”Ÿæˆ `tag.md`  æ–‡ä»¶ã€‚

é‚£ä¹ˆé—®é¢˜åœ¨äºï¼Œæˆ‘ä»¬å¦‚ä½•ç¡®å®šéœ€è¦æ·»åŠ çš„ tag å‘¢ï¼Ÿç½‘ä¸Šå¤§éƒ¨åˆ†çš„æ–¹æ¡ˆæ˜¯æœç´¢å½“å‰å‘å¸ƒçš„æ–‡ç« ï¼Œç„¶åä»ä¸­æå–å‡º tag ï¼Œæœ€åå†æ¯”è¾ƒç¡®å®šå‡ºéœ€è¦è¡¥å……çš„ `tag.md`  æ–‡ä»¶ã€‚è¿™ä¸ªæ–¹æ¡ˆè¡Œå¾—é€šï¼Œä½†ä¸å¤Ÿä¼˜é›…ï¼Œæ›´å¥½çš„æ–¹æ³•æ˜¯æˆ‘ä»¬å¯ä»¥æ„å»ºä¸€ä¸ª APIï¼Œç„¶åç›´æ¥è®© python è¯»å– API æ¥ç¡®å®šéœ€è¦çš„ tagã€‚



### ä¸º Jeklly æ·»åŠ  API

Jekyll æ˜¯é™æ€åšå®¢ç”Ÿæˆå™¨ï¼Œåªèƒ½ç”Ÿæˆé™æ€é¡µé¢ï¼ŒåŸåˆ™ä¸Šæ˜¯æ²¡æ³•åˆ›å»ºä¸€ä¸ªåŠ¨æ€çš„ APIã€‚ä½†çµæ´»åˆ©ç”¨ Liquid çš„è¯­æ³•ï¼Œå¯ç”Ÿæˆä¸€ä¸ªåŒ…å« JSON æ•°æ®çš„æ–‡ä»¶ï¼Œè¿™å°±åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„é™æ€ APIã€‚

æˆ‘ä»¬æ–°å»ºä¸€ä¸ª `api` æ–‡ä»¶å¤¹ï¼Œç„¶åé€šè¿‡å¦‚ä¸‹ Liquid ä»£ç å³å¯å¾—åˆ°ä¸€ä¸ªå…³äºæ–‡ç« ä¿¡æ¯çš„ APIã€‚

```liquid
---
layout: null
permalink: /api/post.json
---
{% raw %}[
    {% for post in site.posts %}{
        "title": {{ post.title | jsonify }},
        "url": {{ post.url | jsonify }},
        "category": {{ post.category | jsonify }},
        "date": {{ post.date | jsonify }},
        "tags": {{ post.tags | jsonify }}
    }{% unless forloop.last %},{% endunless %}
    
    {% endfor %}
]{% endraw %}
```

æˆ‘ä»¬å°†è¯¥ä»£ç ä¿å­˜ä¸º`api` æ–‡ä»¶å¤¹ä¸‹çš„ `post.json` æ–‡ä»¶ï¼Œé‚£ä¹ˆå°±èƒ½è®¿é—®è¯¥ API äº†ã€‚

åœ¨æµè§ˆå™¨ä¸­è¾“å…¥åœ°å€ [https://theigrams.github.io/zjblog/api/post.json](https://theigrams.github.io/zjblog/api/post.json) å³å¯çœ‹åˆ°ç›¸å…³ä¿¡æ¯ã€‚

æˆ–è€…ç”¨ curl æŒ‡ä»¤åœ¨ç»ˆç«¯è¾“å…¥ä¹Ÿå®Œå…¨ OK ğŸ‘Œã€‚

<img src="/zjblog/assets/images/2021-07-23-tag-gen/image-20210725022724002.png" alt="image-20210725022724002" style="zoom:40%;" />

æœ‰äº†ä¹‹å‰çš„çŸ¥è¯†ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆè½»æ¾åœ°å†™å‡ºå…³äº tags çš„APIï¼š

```liquid
---
layout: null
permalink: /api/tags.json
---
{% raw %}{
    {% for tag in site.tags %}
    {{tag[0] | jsonify}}: {{tag[1].size | jsonify}}{% unless forloop.last %},{% endunless %}
    {% endfor %}
}{% endraw %}
```

è¯¥ API å¯ä»¥é€šè¿‡ [https://theigrams.github.io/zjblog/api/tags.json](https://theigrams.github.io/zjblog/api/tags.json) è®¿é—®ã€‚



### Python è¯»å– API å¹¶ç”Ÿæˆ tag.md æ–‡ä»¶

```python
import requests
import os

tags_get = requests.get('http://localhost:4000/zjblog/api/tags.json')
tags = tags_get.json()

# for tag in tags:
#     print(tag+':',tags[tag])

build_tags = [tag for tag in tags]

for root, dirs, files in os.walk('./tag'):
    for file_name in files:
        tag = file_name[:-3]
        if tag in tags and tag in build_tags:
            build_tags.remove(tag)
print("Building new tags:", build_tags)

tag_pattern = '---\n'
tag_pattern += 'layout: tagpage\n'
tag_pattern += 'title: "Tag: %s"\n'
tag_pattern += 'tag: %s\n'
tag_pattern += '---\n'

for tag in build_tags:
    with open('./tag/'+tag+'.md', 'w') as f:
        f.write(tag_pattern % (tag, tag))
```

ä»£ç éå¸¸ç®€å•ï¼Œå°±ä¸èµ˜è¿°äº†ï¼Œåœ¨éœ€è¦æ—¶è¿è¡Œä¸€ä¸‹å³å¯ã€‚



## References

[1] Shopify, [â€œLiquid æ¨¡æ¿è¯­è¨€ä¸­æ–‡æ–‡æ¡£,â€](https://liquid.bootcss.com/) *Liquid æ¨¡æ¿è¯­è¨€ä¸­æ–‡æ–‡æ¡£*.

[2] [â€œç»™GitHub Pagesä¸Šçš„Jekyllç«™ç‚¹æ·»åŠ æ ‡ç­¾æ”¯æŒ,â€](http://www.zerozwt.com/2017/08/28/add-tags-to-jekyll.html) *Zero[Z.W.T] Blog*, Aug. 28, 2017.

[3] L. Qian, [â€œJekyll Tags on Github Pages,â€](http://longqian.me//2017/02/09/github-jekyll-tag/) *Long Qian*, Feb. 09, 2017. 

[4] [â€œä¸º Jekyll æ·»åŠ ä¸€ä¸ªç®€å•çš„ API \| Fooleapâ€™s Blog.â€](https://blog.fooleap.org/create-a-simple-jekyll-api.html ).
